# Messaging Safety Rules
# Granular pre-send validation configuration
# 
# Format:
#   message_types:
#     <category>:
#       <type|*>:
#         allowed_in: [destinations]
#         blocked_in: [destinations]
#         requires_confirmation: [destinations]
#         content_patterns: [regex patterns]
#
# Use '*' for wildcard (matches all subtypes)
# More specific rules override wildcard rules

version: "2.0"

# Group Mappings
# Easy reference for group names â†’ IDs
# Use these aliases in rules instead of remembering numeric IDs
groups:
  # Telegram Groups
  expertclaw_ops:
    id: "-1003732570253"
    platform: "telegram"
    name: "ExpertClaw Ops"
    description: "Internal business operations"
    
  darien_advisors:
    id: "TBD"
    platform: "telegram"
    name: "Darien Advisors"
    description: "External partner group"
    requires_approval: true
    
  # Add your groups here:
  # my_group:
  #   id: "-1001234567890"
  #   platform: "telegram"
  #   name: "My Group Name"

# Define your destinations (users and groups)
destinations:
  boss_dm:
    id: "5185778742"
    type: "telegram"
    name: "Boss (Primary)"
    description: "Direct messages - everything allowed"
    priority: 1
    
  expertclaw_ops:
    id: "-1003732570253"
    type: "telegram"  
    name: "ExpertClaw Ops"
    description: "Internal business operations"
    priority: 2
    
  darien_advisors:
    id: "TBD"
    type: "telegram"
    name: "Darien Advisors"
    description: "External partner group"
    priority: 3
    
  public_channel:
    id: "@channel_handle"
    type: "telegram"
    name: "Public Channel"
    description: "Public announcements"
    priority: 4

# Message type hierarchy
# Format: category.subtype (e.g., digest.reddit, digest.morning)
# Use '*' for wildcard matching
message_types:
  # DIGESTS - Periodic summary content
  digest:
    # Wildcard: applies to ALL digest types
    "*":
      allowed_in: [boss_dm]
      blocked_in: [expertclaw_ops, darien_advisors, public_channel]
      requires_confirmation: []
      reason: "Digests contain internal community content"
      
    # Specific digest types (override wildcard)
    reddit:
      allowed_in: [boss_dm]
      blocked_in: [expertclaw_ops, darien_advisors, public_channel]
      content_patterns:
        - "r/\w+"
        - "reddit"
        - "upvotes"
        - "community"
      reason: "Reddit content is personal research"
      
    morning:
      allowed_in: [boss_dm]
      blocked_in: [expertclaw_ops, darien_advisors, public_channel]
      content_patterns:
        - "Good morning"
        - "Daily briefing"
      reason: "Morning digests are personal"
      
    weekly:
      allowed_in: [boss_dm, expertclaw_ops]
      blocked_in: [darien_advisors, public_channel]
      requires_confirmation: [expertclaw_ops]
      reason: "Weekly summaries may be shared internally with confirmation"

  # REMINDERS - Scheduled notifications
  reminder:
    "*":
      allowed_in: [boss_dm]
      blocked_in: [expertclaw_ops, darien_advisors, public_channel]
      reason: "Reminders are personal"
      
    followup:
      allowed_in: [boss_dm]
      blocked_in: [expertclaw_ops]
      requires_confirmation: [darien_advisors]
      reason: "Follow-ups may involve external parties"

  # BUSINESS - Work-related content
  business:
    "*":
      allowed_in: [boss_dm, expertclaw_ops]
      blocked_in: [darien_advisors, public_channel]
      reason: "Internal business content"
      
    update:
      allowed_in: [boss_dm, expertclaw_ops]
      blocked_in: [darien_advisors]
      
    revenue:
      allowed_in: [boss_dm]
      blocked_in: [expertclaw_ops, darien_advisors, public_channel]
      requires_confirmation: []
      reason: "Financial data is highly sensitive"
      
    client:
      allowed_in: [boss_dm, expertclaw_ops]
      blocked_in: [darien_advisors]
      requires_confirmation: []

  # REPLIES - Responses to messages
  reply:
    "*":
      allowed_in: ["*"]  # Allow in any destination
      blocked_in: []
      requires_confirmation: [darien_advisors]
      reason: "Replies stay in original channel, but confirm for external"

  # ANNOUNCEMENTS - Public communications
  announcement:
    "*":
      allowed_in: [boss_dm, public_channel]
      blocked_in: [expertclaw_ops, darien_advisors]
      requires_confirmation: [public_channel]
      reason: "Public announcements need approval"

  # SYSTEM - Technical/system messages
  system:
    "*":
      allowed_in: [boss_dm, expertclaw_ops]
      blocked_in: [darien_advisors, public_channel]
      
    error:
      allowed_in: [boss_dm, expertclaw_ops]
      blocked_in: [darien_advisors, public_channel]
      
    alert:
      allowed_in: [boss_dm, expertclaw_ops]
      blocked_in: [darien_advisors, public_channel]
      requires_confirmation: []

# Content-based detection rules
# Used when message type is ambiguous
detection_rules:
  - name: "reddit_content"
    patterns:
      - "r/\w+"
      - "reddit.com"
      - "upvotes"
      - "subreddit"
    classify_as: "digest.reddit"
    
  - name: "digest_header"
    patterns:
      - "^ðŸ¦¾.*Digest"
      - "Daily.*Digest"
      - "Morning.*Briefing"
    classify_as: "digest.*"
    
  - name: "reminder_phrases"
    patterns:
      - "Don't forget"
      - "Reminder:"
      - "Upcoming:"
    classify_as: "reminder.*"
    
  - name: "business_phrases"
    patterns:
      - "revenue"
      - "client"
      - "proposal"
      - "meeting"
    classify_as: "business.*"

# Default behavior when no rules match
defaults:
  unknown_message_type:
    action: "ask"  # ask, allow, block
    message: "Unknown message type. Send to Boss DM?"
    
  unknown_destination:
    action: "ask"
    message: "Unknown destination. Confirm send?"

# Emergency override code
override_code: "BOSS_OVERRIDE"
